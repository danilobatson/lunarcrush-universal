🔧 Health Logic Fix - Mon Jul 28 14:31:45 PDT 2025
🔍 Current issue: Health check too strict - marking system unhealthy for API dependency 404
🎯 Solution: Better health logic + option to use Yoga's built-in health
✅ Updated health check logic to be more forgiving

🔄 Key improvements:
  • 404 errors now mark dependency as 'degraded' not 'unhealthy'
  • Overall system status is 'degraded' when dependencies have issues
  • System only 'unhealthy' if core API or critical database fails
  • More nuanced error classification (4xx vs 5xx)

🚀 Deploying improved health logic...

 ⛅️ wrangler 4.26.0
───────────────────
Total Upload: 805.07 KiB / gzip: 143.67 KiB
Worker Startup Time: 17 ms
Your Worker has access to the following bindings:
Binding                                                                           Resource                  
env.DB (lunarcrush-universal-db)                                                  D1 Database               
env.LUNARCRUSH_API_KEY (2593c430bd90424a886728435dd57004/LUNARCRUSH_API_KEY)      Secrets Store Secret      
env.ENVIRONMENT ("production")                                                    Environment Variable      

Uploaded lunarcrush (3.94 sec)
Deployed lunarcrush triggers (0.20 sec)
  https://lunarcrush.cryptoguard-api.workers.dev
Current Version ID: 739d47ea-ee08-445c-8d4e-82931cd315ca
✅ Deployment successful!
⏳ Waiting 10 seconds for deployment...

🧪 Testing improved health check...
New health response:
{
  "status": "degraded",
  "timestamp": "2025-07-28T21:32:07.518Z",
  "uptime": 0,
  "version": "1.0.0",
  "environment": "production",
  "checks": {
    "api": {
      "status": "healthy"
    },
    "database": {
      "status": "healthy"
    },
    "dependencies": {
      "lunarcrush": {
        "status": "degraded",
        "responseTime": 190,
        "error": "Some endpoints unavailable (HTTP 404)"
      }
    }
  }
}
New health status: degraded
✅ Health check now properly shows 'degraded' instead of 'unhealthy'

🎯 Committing improved health logic...
