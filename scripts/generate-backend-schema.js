#!/usr/bin/env node

/**
 * LunarCrush Universal - Backend Schema Generator
 * Generates TypeScript schema file from GraphQL schema for GraphQL Yoga
 *
 * Usage: node scripts/generate-backend-schema.js
 */

const fs = require('fs');
const path = require('path');

console.log('ğŸ”„ Generating backend schema from GraphQL...');

const schemaPath = 'schema/schema.graphql';
const outputPath = 'packages/backend-yoga/src/schema.ts';

// Read GraphQL schema
if (!fs.existsSync(schemaPath)) {
    console.error('âŒ Schema file not found:', schemaPath);
    process.exit(1);
}

console.log('ğŸ“„ Reading schema file...');
const schemaContent = fs.readFileSync(schemaPath, 'utf8');
console.log(`ğŸ“Š Schema content: ${schemaContent.length} characters`);

// Create the TypeScript schema file
const generatedSchema = `// ===================================================================
// ğŸš¨ AUTO-GENERATED FILE - DO NOT EDIT MANUALLY! ğŸš¨
// ===================================================================
// This file is automatically generated from schema/schema.graphql
// To make changes:
// 1. Edit schema/schema.graphql
// 2. Run: npm run codegen:backend
// 3. Or run: node scripts/generate-backend-schema.js
// ===================================================================

/**
 * LunarCrush GraphQL Schema - Auto-Generated from Single Source of Truth
 * Source: schema/schema.graphql (${schemaContent.split('\n').length} lines)
 * Generated: ${new Date().toISOString()}
 */

export const typeDefs = \`${schemaContent.replace(/`/g, '\\`')}\`;

// Re-export for compatibility
export default typeDefs;
`;

// Ensure output directory exists
const outputDir = path.dirname(outputPath);
if (!fs.existsSync(outputDir)) {
    fs.mkdirSync(outputDir, { recursive: true });
}

// Write the generated file
fs.writeFileSync(outputPath, generatedSchema);

console.log(`âœ… Generated ${outputPath}`);
console.log(`ğŸ“Š Output: ${generatedSchema.split('\n').length} lines`);
console.log('ğŸ¯ Ready for GraphQL Yoga usage!');
